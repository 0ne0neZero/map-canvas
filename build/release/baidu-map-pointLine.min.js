!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.PointLine=i()}(this,function(){"use strict";function t(t){this.options=t||{},this.paneName=this.options.paneName||"labelPane",this.zIndex=this.options.zIndex||0,this._map=t.map,this._lastDrawTime=null,this.show()}t.prototype=new BMap.Overlay,t.prototype.initialize=function(t){this._map=t;var i=this.canvas=document.createElement("canvas"),n=this.ctx=this.canvas.getContext("2d");i.style.cssText="position:absolute;left:0;top:0;z-index:"+this.zIndex+";",this.adjustSize(),this.adjustRatio(n),t.getPanes()[this.paneName].appendChild(i);var e=this;return t.addEventListener("resize",function(){e.adjustSize(),e._draw()}),this.canvas},t.prototype.adjustSize=function(){var t=this._map.getSize(),i=this.canvas;i.width=t.width,i.height=t.height,i.style.width=i.width+"px",i.style.height=i.height+"px"},t.prototype.adjustRatio=function(t){var i=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,n=(window.devicePixelRatio||1)/i,e=t.canvas.width,a=t.canvas.height;t.canvas.width=e*n,t.canvas.height=a*n,t.canvas.style.width=e+"px",t.canvas.style.height=a+"px",t.scale(n,n)},t.prototype.draw=function(){var t=this;clearTimeout(t.timeoutID),t.timeoutID=setTimeout(function(){t._draw()},15)},t.prototype._draw=function(){var t=this._map,i=t.getSize(),n=t.getCenter();if(n){var e=t.pointToOverlayPixel(n);this.canvas.style.left=e.x-i.width/2+"px",this.canvas.style.top=e.y-i.height/2+"px",this.dispatchEvent("draw"),this.options.update&&this.options.update.call(this)}},t.prototype.getContainer=function(){return this.canvas},t.prototype.show=function(){this.canvas||this._map.addOverlay(this),this.canvas.style.display="block"},t.prototype.hide=function(){this.canvas.style.display="none"},t.prototype.setZIndex=function(t){this.canvas.style.zIndex=t},t.prototype.getZIndex=function(){return this.zIndex};var i={isPointInRect:function(t,i){if(!(t instanceof BMap.Point&&i instanceof BMap.Bounds))return!1;var n=i.getSouthWest(),e=i.getNorthEast();return t.lng>=n.lng&&t.lng<=e.lng&&t.lat>=n.lat&&t.lat<=e.lat},isPointOnPolyline:function(t,i){if(!(t instanceof BMap.Point&&i instanceof BMap.Polyline))return!1;var n=i.getBounds();if(!this.isPointInRect(t,n))return!1;for(var e=i.getPath(),a=0;a<e.length-1;a++){var o=e[a],s=e[a+1];if(t.lng>=Math.min(o.lng,s.lng)&&t.lng<=Math.max(o.lng,s.lng)&&t.lat>=Math.min(o.lat,s.lat)&&t.lat<=Math.max(o.lat,s.lat)){var h=(o.lng-t.lng)*(s.lat-t.lat)-(s.lng-t.lng)*(o.lat-t.lat);if(h<2e-10&&h>-2e-10)return!0}}return!1}},n={merge:function(t,i){Object.keys(t).forEach(function(n){i[n]=t[n]})},getDistance:function(t,i){return Math.sqrt((t[0]-i[0])*(t[0]-i[0])+(t[1]-i[1])*(t[1]-i[1]))}},e=function(i,n){function e(t){this.name=t.name,this.path=t.path}var a=this;a.map=i,a.lines=[];var o={lineWidth:1,lineStyle:"#F9815C"},s=null,h=i.getSize().width,l=i.getSize().height;e.prototype.getPointList=function(){var t=[],n=this.path;return n&&n.length>0&&n.forEach(function(n){t.push({name:n.name,pixel:i.pointToPixel(n.location)})}),t},e.prototype.draw=function(t){var i=this.getPointList();t.save(),t.beginPath(),t.lineWidth=o.lineWidth,t.strokeStyle=o.lineStyle,t.moveTo(i[0].pixel.x,i[0].pixel.y);for(var n=0,e=i.length;n<e;n++)t.lineTo(i[n].pixel.x,i[n].pixel.y);t.stroke(),t.closePath(),t.restore()};var r=function(){var t=s.canvas.getContext("2d");t&&(c(),t.clearRect(0,0,h,l),a.lines.forEach(function(i){i.draw(t)}))},c=function(){if(!(a.lines&&a.lines.length>0)){o.data.forEach(function(t,i){var n=new e({name:t.name,path:[]});t.data.forEach(function(t,i){n.path.push({name:t.name,location:new BMap.Point(t.Longitude,t.Latitude)})}),a.lines.push(n)})}};a.init(n,o),s=new t({map:i,update:r}),this.clickEvent=this.clickEvent.bind(this),this.bindEvent()};return e.prototype.init=function(t,i){n.merge(t,i),this.options=i},e.prototype.bindEvent=function(t){var i=this.map;this.options.methods&&this.options.methods.click&&(i.setDefaultCursor("default"),i.addEventListener("click",this.clickEvent))},e.prototype.clickEvent=function(t){var n=this,e=n.lines;e.length>0&&e.forEach(function(e,a){var o=[];e.path.forEach(function(t,i){o.push(t.location)});var s=new BMap.Polyline(o);if(i.isPointOnPolyline(t.point,s))return void n.options.methods.click(t,e.name)})},e});