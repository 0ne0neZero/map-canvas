!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.MoveLine=i()}(this,function(){"use strict";function t(t){this.path=t.path,this.age=0,this.maxAge=0}var i={merge:function(t,i){Object.keys(t).forEach(function(e){i[e]=t[e]})},getDistance:function(t,i){return Math.sqrt((t[0]-i[0])*(t[0]-i[0])+(t[1]-i[1])*(t[1]-i[1]))},containStroke:function(t,i,e,n,o,a,s){if(0===o)return!1;var r=o,p=0,h=t;if(s>i+r&&s>n+r||s<i-r&&s<n-r||a>t+r&&a>e+r||a<t-r&&a<e-r)return!1;if(t===e)return Math.abs(a-t)<=r/2;p=(i-n)/(t-e),h=(t*n-e*i)/(t-e);var l=p*a-s+h;return l*l/(p*p+1)<=r/2*r/2}},e="undefined"==typeof window?{}:window,n=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame||function(t){return e.setTimeout(t,1e3/60)},o=function(t,i){var e=this;e.map=t,e.lines=[],e.pixelList=[];var n={lineWidth:.5,lineStyle:"rgb(200, 40, 0)",animateLineWidth:1,animateLineStyle:"#ffff00"};e.init(i,n);var o=e.baseCtx=e.options.canvas.getContext("2d");e.animateCtx=e.options.animateCanvas.getContext("2d");o.lineWidth=n.lineWidth};return o.prototype.init=function(t,e){i.merge(t,e),this.options=e},o.prototype.render=function(){var t=this,i=t.baseCtx;i&&(t._addLine(),t.pixelList=[],t.lines.forEach(function(e){t.pixelList.push({data:e.getPointList(t.map)}),e.drawPath(i,t.map,t.options)}))},o.prototype.animate=function(){var t=this,i=t.animateCtx;if(i){t._addLine(),i.fillStyle="rgba(0, 0, 0, 0.7)";var e=i.globalCompositeOperation;i.globalCompositeOperation="destination-in",i.fillRect(0,0,t.map.width,t.map.height),i.globalCompositeOperation=e,t.pixelList=[],t.lines.forEach(function(e){t.pixelList.push({data:e.getPointList(t.map)}),e.draw(i,t.map,t.options)})}},o.prototype.start=function(){var t=this;t.stop(),t.render(),function i(){t.timer=setTimeout(function(){n(i),t.animate()},60)}()},o.prototype.stop=function(){this.timer&&clearTimeout(this.timer)},o.prototype._addLine=function(){var i=this;if(!(i.lines&&i.lines.length>0)){i.options.data.forEach(function(e,n){var o=new t({path:e});i.lines.push(o)})}},t.prototype.getPointList=function(t){var i=[],e=this.path;return e&&e.length>0&&(e.forEach(function(e){i.push({pixel:t.toScreen(e)})}),this.maxAge=i.length),i},t.prototype.drawPath=function(t,i,e){var n=this.pixelList||this.getPointList(i);t.beginPath(),t.lineWidth=e.lineWidth,t.strokeStyle=e.lineStyle,t.moveTo(n[0].pixel.x,n[0].pixel.y);for(var o=0,a=n.length;o<a;o++)t.lineTo(n[o].pixel.x,n[o].pixel.y);t.stroke()},t.prototype.draw=function(t,i,e){var n=this.pixelList||this.getPointList(i);t.beginPath(),t.lineWidth=e.animateLineWidth,t.strokeStyle=e.animateLineStyle,this.age>=this.maxAge-1&&(this.age=0),t.moveTo(n[this.age].pixel.x,n[this.age].pixel.y),t.lineTo(n[this.age+1].pixel.x,n[this.age+1].pixel.y),t.stroke(),this.age++},o});