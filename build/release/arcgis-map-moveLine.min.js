!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.MoveLine=i()}(this,function(){"use strict";var t=function(t,i){Object.keys(t).forEach(function(e){i[e]=t[e]})},i="undefined"==typeof window?{}:window,e=i.requestAnimationFrame||i.mozRequestAnimationFrame||i.webkitRequestAnimationFrame||i.msRequestAnimationFrame||function(t){return i.setTimeout(t,1e3/60)},n=i.cancelAnimationFrame||i.mozCancelAnimationFrame||i.webkitCancelAnimationFrame||i.msCancelAnimationFrame||function(t){clearTimeout(t)},o=function(t,i){var e=this;e.map=t;var n={lineWidth:.5,lineStyle:"rgb(200, 40, 0)",animateLineWidth:1,animateLineStyle:"#ffff00"};e.init(i,n);var o=e.baseCtx=e.options.canvas.getContext("2d");e.animateCtx=e.options.animateCanvas.getContext("2d");o.lineWidth=n.lineWidth};function a(t){this.points=t.points||[],this.age=t.age||0,this.maxAge=t.maxAge||0}return o.prototype.init=function(i,e){t(i,e),this.options=e},o.prototype.render=function(){var t=this,i=t.baseCtx;i&&t.roadLines.forEach(function(e){e.drawPath(i,t.map,t.options)})},o.prototype.animate=function(){var t=this,i=t.animateCtx;if(i){i.fillStyle="rgba(0,0,0,0.7)";var e=i.globalCompositeOperation;i.globalCompositeOperation="destination-in",i.fillRect(0,0,t.map.width,t.map.height),i.globalCompositeOperation=e,t.roadLines.forEach(function(e){e.draw(i,t.map,t.options)})}},o.prototype.start=function(){var t=this;t.stop(),t.addLine(),t.render(),function i(){t.timer=setTimeout(function(){t.animationId=e(i),t.animate()},50)}()},o.prototype.stop=function(){var t=this;n(t.animationId),t.timer&&clearTimeout(t.timer)},o.prototype.addLine=function(){var t=this.roadLines=[];this.options.data.forEach(function(i,e){t.push(new a({points:i}))})},a.prototype.getPointList=function(t){var i=this.path=[],e=this.points;return e&&e.length>0&&(e.forEach(function(e){i.push({pixel:t.toScreen(e)})}),this.maxAge=i.length),i},a.prototype.drawPath=function(t,i,e){var n=this.path||this.getPointList(i);t.beginPath(),t.lineWidth=e.lineWidth,t.strokeStyle=e.lineStyle,t.moveTo(n[0].pixel.x,n[0].pixel.y);for(var o=0,a=n.length;o<a;o++)t.lineTo(n[o].pixel.x,n[o].pixel.y);t.stroke()},a.prototype.draw=function(t,i,e){var n=this.path||this.getPointList(i);t.beginPath(),t.lineWidth=e.animateLineWidth,t.strokeStyle=e.animateLineStyle,this.age>=this.maxAge-1&&(this.age=0),t.moveTo(n[this.age].pixel.x,n[this.age].pixel.y),t.lineTo(n[this.age+1].pixel.x,n[this.age+1].pixel.y),t.stroke(),this.age++},o});